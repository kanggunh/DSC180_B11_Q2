Paper #: 133

Data collection Provide details about the data collection procedure, including the instruments or devices used to record the data (e.g. pen and paper,  computer, eye tracker, video or audio equipment) whether anyone was present besides the participant(s) and the researcher, and whether the researcher was blind to experimental condition and/or the study hypothesis during data collection. 
 Timing Indicate the start and stop dates of data collection. If there is a gap between collection periods, state the dates for each sample cohort. 
 Data exclusions If no data were excluded from the analyses, state so OR if data were excluded, provide the exact number of exclusions and the rationale behind them, indicating whether exclusion criteria were pre-established. 
 Non-participation State how many participants dropped out/declined participation and the reason(s) given OR provide response rate OR state that no participants dropped out/declined participation. 
 Randomization If participants were not allocated into experimental groups, state so OR describe how participants were allocated to groups, and if allocation was not random, describe how covariates were controlled. 
 Ecological, evolutionary & environmental sciences study design All studies must disclose on these points even when the disclosure is negative. 
 Study description Briefly describe the study. For quantitative data include treatment factors and interactions, design structure (e.g. factorial, nested, hierarchical), nature and number of experimental units and replicates. 
 Research sample Describe the research sample (e.g. a group of tagged Passer domesticus, all Stenocereus thurberi within Organ Pipe Cactus National Monument), and provide a rationale for the sample choice. When relevant, describe the organism taxa, source, sex, age range and any manipulations. State what population the sample is meant to represent when applicable. For studies involving existing datasets, describe the data and its source. 
 Sampling strategy Note the sampling procedure. Describe the statistical methods that were used to predetermine sample size OR if no sample-size calculation was performed, describe how sample sizes were chosen and provide a rationale for why these sample sizes are sufficient. 
 Data collection Describe the data collection procedure, including who recorded the data and how. Timing and spatial scale Indicate the start and stop dates of data collection, noting the frequency and periodicity of sampling and providing a rationale for these choices. If there is a gap between collection periods, state the dates for each sample cohort. Specify the spatial scale from which the data are taken 
 Data exclusions If no data were excluded from the analyses, state so OR if data were excluded, describe the exclusions and the rationale behind them, indicating whether exclusion criteria were pre-established. 
 Reproducibility Describe the measures taken to verify the reproducibility of experimental findings. For each experiment, note whether any attempts to repeat the experiment failed OR state that all attempts to repeat the experiment were successful. 
 Randomization Describe how samples/organisms/participants were allocated into groups. If allocation was not random, describe how covariates were controlled. If this is not relevant to your study, explain why. 
 Blinding Describe the extent of blinding used during data acquisition and analysis. If blinding was not possible, describe why OR explain why blinding was not relevant to your study. 
 Did the study involve field work? Yes No Reporting for specific materials, systems and methods We require information from authors about some types of materials, experimental systems and methods used in many studies. Here, indicate whether each material, system or method listed is relevant to your study. If you are not sure if a list item applies to your research, read the appropriate section before selecting a response.
boosting classifier model; and d, the XGboost model in the second round of ML. methods, i.e., PBE, PBE+SOC and HSE+SOC. We show the PDOS results using PBE method here. (Continued) Supplementary Fig.  9  PDOS of 24 potential PH anions (including the chosen thioglycolate 14 ligand) without localized states near the band edges regardless of the calculation method levels. We employed three different calculation methods, i.e., PBE, PBE+SOC and HSE+SOC. We show the PDOS results using PBE method here. (Continued) Supplementary Fig.  10  PDOS of several characteristic PH anions with localized states near the band edges in PBE calculation method. We employed three different calculation methods, i.e., PBE, PBE+SOC and HSE+SOC. Supplementary Table  1 . Summary of certified PV parameters of inverted PSCs (QSS=quasisteady-state measurement). Third-party certification institutes: National Renewable Energy Lab (NREL); National Institute of Metrology (NIM, China); Enli Technology Optoelectronic Calibration Laboratory (ETOCL); Shanghai Institute of Microsystem and Information Technology (SIMIT); Solar Energy Research Institute of Singapore (SERIS). 
 PCE Technique Ref 
 22.34% (Newport; QSS) A cation (alkylamine ligands) X. Zheng, Nat. Energy (2020)  1  21.3% (NIM) 2D MOF S. Wu, Nat Nanotechnol (2020)  2  22.62% (NREL; QSS) A cation (ammonium ligands) S. Chen, Sci. Adv. (2021)  3   
 23.09% (ETOCL) A cation (ammonium ligands) G. Yang, Nat. Photonics (2021)  4  23.5% (SIMIT) Heterojunctions X. Li, Science (2022)  5  23.91% (NREL; QSS) A cation (ammonium ligands) H. Chen, Nat. Photonics (2022)  6  24.05% (NREL; QSS) A cation (MPyFA+) Q. Qiang, Nature (2022)  7  23.25% (SERIS) A cation, 3D/LD S. Ye, Nat. Energy (2023)  8  24.04% (NREL; QSS) 24 properties of NaI-treated films and compared them with control and ST-treated films. Thin-film XRD shows no observable change in bulk perovskite crystallinity (Fig.  5a  and Supplementary Fig.  18a ), and SEM indicates minimal changes in surface morphology (Supplementary Fig.  13 ). Comparing the optoelectronic impact using PLQY (Supplementary Fig.  14 ), we observed that the PLQY increased from 20% in the control to 23% with an NaI treatment but remained much lower than the ST-treated films at 43%. When we fabricated perovskite solar cell devices (Fig.  4c ), we found that NaI resulted in device performance better than the control, in line with the PLQY results, but lower than the ST-treated devices. Above results confirm that sodium plays a limited role in improving the device performance. oxygen and moisture.  13, 14  Such decomposition produces volatile decomposition products such as MAI and HI which can diffuse and react with the metal electrodes in the absence of a conformal blocking layer.  13  import pubchempy as pcp c = pcp.Compound.from_cid(source data from step1) cw = c.molecular_weight cc = c.charge Step3: Grab the "canonical_smiles" and "InChI" from the Pubchem database. Step4: Grab the "csid number" from the Chemspider database using the data obtained in Step3. cs = ChemSpider('input your KEY in Chemspider') ch=cs.filter_smiles(smiles) or ch=cs.filter_smiles(inchi) t=cs.filter_results(ch) 
 info=cs.get_details(t[0]) spider_id=info['id'] Step5: Download 3D structures from the Chemspider database using the data obtained in Step4. Step6: Using Gaussian and Multiwfn software to calculate the "Molecular radii". The Gaussian code can be found at  https://gaussian.com/ . The Multiwfn code can be found at  http://sobereva.com/multiwfn/    # A higher feature importance or absolute feature coefficient indicates that a feature is more important in ML models. As shown in Supplementary Fig.  6 , we thus identify four primary features that influence the Eb classification, including the number of oxygen atoms (num_O), topological polar surface area (TPSA), hydrogen bond acceptor count (HBA) and highest occupied molecular orbital levels (HOMO). # Second round of ML import pandas as pd data=pd.read_csv('Dataset.csv',usecols=['num_O','TPSA','HBA','HOMO','Binding energy']) # Repeat above processes in the first round of ML: "Data standardization", "Split into train sets and test sets", "ML model construction", and "Feature importance plot". # The results of feature importance are shown in Supplementary Fig.  7   
 Data Policy information about availability of data All manuscripts must include a data availability statement. This statement should provide the following information, where applicable: -Accession codes, unique identifiers, or web links for publicly available datasets -A description of any restrictions on data availability -For clinical datasets or third party data, please ensure that the statement adheres to our policy The dataset used for machine learning is provided as a supplementary table. 
 Human research participants Policy information about studies involving human research participants and Sex and Gender in Research.  
 Reporting on sex and gender 
 Ethics oversight Identify the organization(s) that approved the study protocol. Note that full information on the approval of the study protocol must also be provided in the manuscript. 
 Field-specific reporting Please select the one below that is the best fit for your research. If you are not sure, read the appropriate sections before making your selection. 
 Life sciences Behavioural & social sciences Ecological, evolutionary & environmental sciences For a reference copy of the document with all sections, see nature.com/documents/nr-reporting-summary-flat.pdf 
 Life sciences study design All studies must disclose on these points even when the disclosure is negative. 
 Sample size Describe how sample size was determined, detailing any statistical methods used to predetermine sample size OR if no sample-size calculation was performed, describe how sample sizes were chosen and provide a rationale for why these sample sizes are sufficient. Data exclusions Describe any data exclusions. If no data were excluded from the analyses, state so OR if data were excluded, describe the exclusions and the rationale behind them, indicating whether exclusion criteria were pre-established. 
 Replication Describe the measures taken to verify the reproducibility of the experimental findings. If all attempts at replication were successful, confirm this OR if there are any findings that were not replicated or cannot be reproduced, note this and describe why. Randomization Describe how samples/organisms/participants were allocated into experimental groups. If allocation was not random, describe how covariates were controlled OR if this is not relevant to your study, explain why. 
 Blinding Describe whether the investigators were blinded to group allocation during data collection and/or analysis. If blinding was not possible, describe why OR explain why blinding was not relevant to your study. 
 Behavioural & social sciences study design All studies must disclose on these points even when the disclosure is negative. 
 Study description Briefly describe the study type including whether data are quantitative, qualitative, or mixed-methods (e.g. qualitative cross-sectional, quantitative experimental, mixed-methods case study).  Pseudo-halide (PH) anion engineering has emerged as a surface passivation strategy of interest for perovskite-based optoelectronics; but until now, PH anions have led to insufficient defect passivation and thus to undesired deep impurity states. The size of the chemical space of PH anions (>10 6 molecules) has so far limited attempts to explore the full family of candidate molecules. We created a machine learning workflow to speed up the discovery process using full-density functional theory calculations for training the model. The physics-informed machine learning model allowed us to pinpoint promising molecules with a head group that prevents lattice distortion and anti-site defect formation, and a tail group optimized for strong attachment to the surface. We identified 15 potential bifunctional PH anions with the ability to passivate both donors and acceptors, and through experimentation, discovered that sodium thioglycolate was the most effective passivant. This strategy resulted in a power-conversion efficiency of 24.56% with a high open-circuit voltage of 1.19 volts (24.04% National Renewable Energy Lab-certified quasi-steady-state) in inverted perovskite solar cells. Encapsulated devices maintained 96% of their initial power-conversion energy during 900 hours of one-sun operation at the maximum power point. 
 Research sample The optoelectronic properties of metal halide perovskite materials have enabled rapid progress in solar cell efficiency  1  . Further increases in power-conversion efficiency (PCE) require improved open-circuit voltage (V OC ), as the short circuit current (J SC ) is now close to the Shockley-Queisser limit  2  . The V OC of perovskite solar cells (PSCs) is curtailed by non-radiative recombination arising due to surface and interfacial trap states. In addition, these defects accelerate PSC degradation, facilitating rapid halide-ion migration  3  and chemical reactions with water, oxygen and light  4  . Generally, perovskite compounds have a chemical formula ABX 3 , where 'A' is a monovalent cation, 'B' is a divalent cation and 'X' is a halide anion. Ammonium ligands (PEA + , BA + , F-PEA + , among others)  5, 6  are now widely employed for passivation (Supplementary Table  1 ). However, this A-site passivation technique commonly demands delicate control over the dimensionality of the two-dimensional layer making up the two-dimensional:three-dimensional heterostructure. Furthermore, associated ligand intercalation has been documented to lead to degradation  7, 8  . More recently, the use of pseudo-halide (PH) anions for X-site passivation has gained attention as it avoids the formation of lower-dimensional phases. X-site defects are more deleterious than A-site defects, motivating a focus onto their passivation  9  . However, only a few PH anions have been reported to work well in PSCs  [10] [11] [12]  , a trend that we posited could arise from inefficient passivation and the introduction of unwanted deep impurity states induced by PH anions. This led us to hypothesize that a full search of the associated chemical space could Department of Electrical and Computer Engineering, University of Toronto, Toronto, Ontario, Canada.  2  Department of Chemistry, Northwestern University, Evanston, IL, USA.  3  Department of Electrical and Computer Engineering, Northwestern University, Evanston, IL, USA.  4  These authors contributed equally: Jian Xu, Hao Chen, Luke Grater. e-mail: ted.sargent@utoronto.ca Article  https://doi.org/10.1038/s41563-023-01705-y  After two rounds of ML training, we identify four primary features that influence the E b classification, including the number of oxygen atoms (num_O), topological polar surface area (TPSA), hydrogen bond acceptor count (HBA) and highest occupied molecular orbital levels (HOMO). Using these four features, we achieve a receiver operating characteristic (ROC) area under curve (AUC) score of 0.87 and an accuracy score of 0.84 in the random forest model (Fig.  2c , top panel, and Supplementary Fig.  5 ). In the logistic regression model, features with positive coefficients are beneficial for the positive label ('higher E b ' class) (Fig.  2c  and Supplementary Figs.  6  and 7 ). We thus provide a set of guidelines for the binding energy determination: PH anions with more num_O, larger TPSA, more HBA and lower HOMO levels tend to exhibit stronger binding strength with the perovskite surface. Physically, a higher num_O provides more active sites to interact with Pb 2+ at the perovskite surface via coordination bonding. For example, we found that PH anions with SO 3 -functional groups at the head-side tend to have higher binding energy than those with CO 2 -functional groups. More HBA, defined as the sum of atoms in the molecule that contain lone electron pairs participating in the hydrogen bonding  15  , indicates increased likelihood to form hydrogen bonds between PH anions and the NH 3 + group of FA + /MA. TPSA is also linked to the hydrogen bonding (both donor and acceptor groups)  15  . The HOMO levels are mostly situated on the electron-rich side, as shown by the red electrostatic potential (ESP) regions (Fig.  2b ). Lower HOMO levels usually indicate a higher electronegativity  16, 17  , resulting in stronger electrostatic interaction between the PH anion and a positively charged defect (for example, V I ) on the perovskite surface. Thus, when we progress I -, Br -, Cl -, to F -, the increased electronegativity is accompanied by decreased p-orbital energy levels, and stronger E b (Fig.  2a ). 
 Bifunctional defect passivation mechanism We also sought to prevent deep impurity states caused by the PH treatment itself, as they increase non-radiative losses. This prompted us to look for safe functional groups: in the higher E b class (E b > 3 eV), we identify 24 potential PH anions (Figs.  2a  and 3d ) that did not produce localized states near the band edges, regardless of the calculation method level used (see detailed electronic structures in Supplementary Figs. 8-10 and Supplementary Note 2). The candidate molecules that emerged prompted us to look at the effect of functional groups on the formation of I Pb anti-site defects (Fig.  3a ), known to lead to deep levels within the bandgap in (MA/FA) PbI 3 perovskites  18, 19  . We found that SO 3 -functional groups cause greater surface-structure distortion that inhibits the passivation of negatively charged I Pb anti-site defects, while CO 2 -prevents the formation of I Pb -but, as previously noted, has a lower surface binding strength. To overcome this undesirable trade-off, we explored bifunctional ligands: a head group (electron-rich side) with less surface-structure distortion and anti-site defect generation; and a tail (electron-poor side) engineered to increase binding affinity. In this work, we defined 'bifunctional passivation' as the ability to passivate both positively charged and negatively charged defects at perovskite surface. Specifically, the CO 2 -functional group seemed a good choice for the head-side, providing less steric hindrance and reduced distortion; and either chalcogen-or halogen-containing functional groups for the tail to increase binding affinity. To evaluate candidate tail groups, we calculated the integrated crystal orbital Hamilton population (ICOHP)  20  , a measure of bonding strength. As shown in Fig.  3b , we found that those with the S atom at the tail-side forms a stronger coordination bond with Pb 2+ than do the other candidates (for example, O-Pb, Cl-Pb and F-Pb). A stronger bond suggests it would cost more energy to break the initial bonding to create I Pb defects. Therefore, it appears that bifunctional PH anions can simultaneously fill donor-like defects V I , while also passivating acceptor-like defects (I Pb ). As shown in Fig.  3a , there are 15 PH anions having defect formation energies ΔE f (I Pb ) > 0, which are considered as bifunctional ligands. potentially uncover new and effective passivants, and thus harness the passivation potential of this diverse class of molecules in PSCs. We thus embarked on a systematic search for PH anions exhibiting strong binding to the perovskite surface, which we offer as a surrogate for the degree of passivation. To this, a further criterion was added: the anions should not introduce impurity states in the perovskites. Given the large chemical space, it would be impractical to rely on conventional trial-and-error. Instead we sought a route to study structure-propertyperformance relationships in a high throughput manner  13, 14  , seeking to understand how the PH anion's chemical structure influences its ability to passivate. 
 Workflow for materials screening To accomplish this, we used density functional theory (DFT) on a subset of the chemical space and trained thusly a machine learning (ML) model (Fig.  1a ). First we screened the PH space for experimentally reasonable candidates. A multistep screening funnel considered the charge state (tier 1), molecular weight (tier 2), availability of three-dimensional structures (tier 3), molecular radii (tier 4), presence of Na or K salts (tier 5), and salt purchase availability (tier 6). The rationale for specific threshold values used in the materials screening procedure are discussed in Supplementary Note 1 and Supplementary Fig.  1 . Only 168 PH anions remained out of five million molecules derived from the PubChem database. We investigated the interaction between PH anions and the perovskite surface (Fig.  1b ) using FA 0.75 MA 0.25 PbI 3 as a model system for investigation. The PH anions can interact with the perovskite surface via substitution, wherein the PH anion replaces an X (I -) atom; or via adsorption through binding with under-coordinated B 2+ (Pb 2+ ) cations. From formation energies (ΔE formation ) (Fig.  1c ), we find that substitution is more thermodynamically favourable than adsorption in most I chemical potential (Δμ I ) regions. This is attributed to the formation of more ionic bonds between Pb 2+ and the electron-rich group of PH anions, as well as more hydrogen bonds between NH 3 + group of FA + /MA + and PH anions. The charge density difference reveals charge transfer between PH anions at the surface and the perovskite slab, indicating that PH anions could attract electrons from neighbouring Pb and MA/ FA atoms (Supplementary Fig.  2 ). In light of this understanding of the PH anion passivation mechanism, we performed DFT calculations to obtain estimates for the binding energies (E b ) (Supplementary Fig.  3 ) of PH anions with the perovskite surface. As shown in Fig.  2a , several new PH anions have even higher E b than the 16 anions studied in earlier literature. The calculated E b trends in FA 0.75 MA 0.25 PbI 3 appear to extend well to other perovskite compositions, for example, FA 0.75 Cs 0.25 PbI 3 (normal bandgap), FA 0.75 MA 0.25 Pb 0.5 Sn 0.5 I 3 (narrow bandgap) and FA 0.75 Cs 0.25 Pb(I 0.625 Br 0.375 ) 3 (wide bandgap), as seen in Supplementary Fig.  4 . Since higher E b indicates stronger binding strength to iodine vacancies, V I , we expect these candidates to offer enhanced passivation. 
 Machine-learning-model training and analysis We then sought to develop a physics-informed machine learning (ML) model to investigate how the molecular structure of PH anions regulates their interaction strength with the perovskite surface. Screened PH anions have diverse electron-rich functional groups, including Jeong et al. reported that the PH anion, formate (HCOO -), had a binding energy of 3.1 eV, resulting in record-performing n-i-p (negative-intrinsic-positive) PSCs, while chloride (Cl -) had a binding energy of 2.98 eV (ref. 10). In light of this, we used 3 eV as a basis to classify 267 PH anions, including our 168 screened p-h anions (Fig.  1a ), into high/low E b : thus the PH anions are either labelled as higher E b (201 anions) or as lower E b (66 anions), and these are taken as the ML outputs. As shown in Fig.  2b , we initially considered 19 features of the PH anions as ML inputs (see Methods for ML details). We also sought to calculate the anion migration barrier (∆E a ) at the perovskite surface, as halide migration is one cause of current-voltage hysteresis and decomposition of perovskite films  3  . As shown in Fig.  3c  and Supplementary Fig.  11 , ∆E a for I -(vacancy mediated) is 0.23 eV (averaged), consistent with previous calculation results  21  . We find that Br -, Cl -and F -have an increased ∆E a of 0.27 eV, 0.32 eV and 0.37 eV, linked to enhanced electronegativity and binding strength with the perovskite surface (Fig.  2a ). The optimal bifunctional PH anions (ligand 14) further increase the ∆E a to 0.43 eV, the result of enhanced binding strength and the additional PH anion, FA + /MA + molecular rotation barrier, the latter absent in halide (I -, Br -, Cl -) migration. R-SO 3 - , R-SO 2 - , R-CO 2 - , R-COS -, R-S 2 O 2 - , R-CS 2 - , R-BF 3 - , PO 3 - , R-PO 2 - , R-PHO 3 - , R-S -, R-O -. 
 Photovoltaic performance of PSCs Experimentally, we took five bifunctional PH anions with higher E b for further investigation. We dissolved PH anion salts in a solution of isopropanol (IPA), which we spin coated on perovskite films at 0.5 mg ml -1  (Supplementary Fig.  12 ) and then annealed at 100 °C (Methods). We then fabricated inverted PSC devices without and with PH anion treatments (Fig.  4a ). We employed Cs 0.05 FA 0.9 MA 0.05 Pb(I 0.95 Br 0.05 ) 3 perovskite with a bandgap of 1.55 eV as the absorber. The PSCs had an inverted device architecture of ITO/NiO x /Me-4PACz/perovskite/C 60 /BCP/Ag, where ITO is indium tin oxide, Me-4PACz is [4-(3,6-dimethyl-9H-carb azol-9-yl)butyl]phosphonic acid, C 60 is fullerene and BCP is bathocuproine. In PSCs with an inverted (p-i-n) device structure, the interface between the perovskite layer and the electron transport layer (ETL) has been proven to be the most crucial to device performance due to substantial interfacial non-radiative recombination  22, 23  . This motivated us to focus on the use of a PH anion passivation layer at the perovskite/ ETL interface. Figure  4b  shows the current density-voltage (J-V) curves for control versus five PH anion-treated devices under forward and reverse scanning. It reveals that sodium thioglycolate (ST) performed the best, though all five PH anions showed improved performance over controls. This we attributed to the optimal bifunctional passivation effect of thioglycolate. Both control and PH anion-treated devices exhibit low hysteresis. Figure  4c  shows device performance statistics using five different PH anion treatments (ST (ligand 14); sodium chlorate (SC) (ligand 2); potassium bicarbonate (PB) (ligand 7); sodium hydroxyacetate (SH) (ligand 13); and monosodium methylphosphonate (MMP) (ligand 12)). We found that the V OC and PCE of these five PH anion-treated devices followed the order: ST best, SC worst, and SH, MMP and PB were in between. This sequence is consistent with the order of the calculated ΔE f (I Pb ) of Fig.  3a : ST > SH > MMP > PB > SC. The role of sodium was discussed in Supplementary Note 3 and Supplementary Figs.  13  and 14 . In ST-treated devices, V OC and the fill factor (FF) were the basis of the improvement, with J SC remaining effectively unchanged. V OC improved from 1.14 V in control to 1.19 V in ST-treated devices and FF increased from 81.9% to 83.6% (see detailed photovoltaic (PV) parameters in Fig.  4b ). The ST-treated devices had a considerably higher stabilized power output of 24.2% compared with 22.5% for the controls (Supplementary Fig.  15 ). External quantum efficiency spectra (Supplementary Fig.  16 ) verified the J SC values obtained from the J-V  
 Article https://doi.org/10.1038/s41563-023-01705-y  measurements. We fabricated 15 ST-treated PSCs and the narrow PCE distribution indicates good reproducibility (statistics in Fig.  4c ). An ST-treated device was certified at an independent institute, National Renewable Energy Lab, and achieved a quasi-steady-state PCE of 24.04% (V OC = 1.16 V, J SC = 25.12 mA cm -2 and FF = 82.48%) (Supplementary Fig.  17 ). This efficiency ranks amongst the best reported in the literature for inverted PSCs (Supplementary Table  1 ). Next, we sought to characterize the morphology and crystallinity of the perovskite films to reveal the interaction between the perovskite and the PH anion treatments. Top down and cross-sectional scanning electron microscopy (SEM) images show that the film morphology remains unchanged after the PH anion treatments (Supplementary Figs.  13  and 20 ). The PH anion treatments did not affect overall crystallinity and perovskite phase, with no erroneous peaks, and lack of correlative peak shifting, broadening, or intensity differences, as evidenced by indexed thin-film and simulated X-ray diffraction (XRD) patterns (Supplementary Figs.  18  and 19 ). Additionally, ST and MMP treatments are found to reduce excess PbI 2 , an added benefit for stability (Fig.  5a  and Supplementary Fig.  18 ). The impact of posttreatment recrystallization on the morphology of perovskite thin films was discussed in Supplementary Note 4 and Supplementary Figs.  20  and 21 . To ascertain whether our top performing PH anion (thioglycolate) was present following posttreatment, we used X-ray photoelectron spectroscopy (XPS), whose O 1s peak (Fig.  5b ) and S 2p peak (Fig.  5c ) suggest that PH anions anchor at the perovskite film surface. Upon ST treatment, a binding energy shift of 0.24 eV and 0.34 eV was observed for the Pb 4f 5/2 and Pb 4f 7/2 orbitals, respectively, indicating a strong interaction between the PH anion and the perovskite surface (Fig.  5d ).  The loss in PCE is primarily due to a decrease in current density, whereas the voltage showed little degradation (Supplementary Figs.  28  and 29 ). The MPP tracking findings are consistent with a picture of mitigated ion migration at the perovskite surface (Fig.  3c ) and the reduction of PbI 2 in thin-film XRD (Fig.  5a ). The present study suggests that continued progress in combined computational, ML and experimental efforts has further potential for the discovery of molecular strategies to increase performance in optoelectronics, including photovoltaics, as well as in related light-emitting devices. 
 Online content Any methods, additional references, Nature Portfolio reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests; and statements of data and code availability are available at  https://doi.org/10.1038/s41563-023-01705-y .   
 Perovskite film and device fabrication NiO x nanocrystal (10 mg ml -1 ) layers were first spin coated on ITO substrates at 3,000 r.p.m. for 25 s in air without any posttreatment, then the substrates were immediately transferred to the glovebox. The NiO x nanoparticles were synthesized via the hydrolysis reaction of nickel nitrate referring to our previous work  33  . Me-4PACz (0.3 mg ml -1 ) in ethanol was spin coated on the NiO x film at 3,000 r.p.m. for 25 s and then annealed at 100 °C for 10 min. We opted to construct a NiO x -Me-4PACz hole transport layer due to the well-documented ability of Me-4PACz to improve the photovoltaic performance of PSCs 34 , while NiO x acts to improving the wettability of perovskite on the self-assembled monolayer. Perovskite precursor solution (1.5 M, Cs 0.05 FA 0.9 MA 0.05 Pb(I 0.95 Br 0.05 ) 3 ) was prepared by dissolving the PbI 2 , PbBr 2 , MABr, CsI, and FAI in a mixture of solvents DMF and DMSO at a volume ratio of 4:1. For the perovskite film fabrication, the substrate was spun at 2,000 r.p.m. for 35 s with an acceleration of 1,000 r.p.m. per second at first, and then at 7,000 r.p.m. for the 10 s with an acceleration of 7,000 r.p.m. per second. In the second step, 150 μl Anisole was dropped onto the substrate during the last 5 s of the spinning. The substrate was immediately placed on a hotplate and annealed at 100 °C for 10 min. For the posttreatment, the ligands were dissolved in IPA solution with concentration of 0.5 mg ml -1 , the surface treatment was finished by depositing 130 μl organic salts solution onto the perovskite film surface at a spin rate of 4,000 r.p.m. for 25 seconds with a 1,000-r.p.m. per second acceleration. The film was then annealed at 100 °C for 5 min to remove any residual IPA. After cooling to room temperature, the substrates were transferred to the evaporation system, 20 nm C 60 , 8 nm BCP and 140 nm Ag were subsequently deposited by thermal evaporation. For PSCs used in MPP tracking, 8 nm of BCP was replaced with 20 nm of atomic-layer-deposited tin(IV) oxide (ALD-SnO 2 ) to limit environmentally induced degradation (Supplementary Note 8). Deposition of the ALD-SnO 2 was carried out using a PICOSUN R-200 Advanced ALD system. Water and tetrakis(dimethylamino)tin(IV) were used as the oxygen and tin precursors, respectively. The precursor and substrate temperature were set to 75 °C and 85 °C, respectively. Nitrogen gas (90 sccm) was used as carrier gas. The pulse and purge times for water were 1 s and 5 s, respectively, while for tetrakis(dimethylamino)tin(IV), they were 1.6 s and 5 s, respectively. The total number of cycles is 134, corresponding to 20 nm of SnO 2 . 
 Device test The current density-voltage (J-V) characteristics were measured using a Keithley 2400 source meter under illumination from a solar simulator (Newport, Class A) with a light intensity of 100 S5 mW cm -2 (checked with a calibrated reference solar cell from Newport). J-V curves were measured in a nitrogen atmosphere with a scanning rate of 100 mV s -1 (voltage step of 10 mV and delay time of 200 ms). The active area was determined by the aperture shade mask (0.049 cm 2 for small-area devices) placed in front of the solar cell. A spectral mismatch factor of 1 was used for all J-V measurements. We verified the effect of our champion passivator, ST, on the performance of PSCs at an independent third-party laboratory (Supplementary Note 9 and Supplementary Fig.  32 ). 
 Stability tests of solar cells The stability tracking depicted in Fig.  5f  is carried out under simulated 1-sun conditions utilizing a homemade white-light LED tracker. The intensity of the white-light LED tracker is calibrated to match 1-sun conditions. In contrast, the stability tracking in Supplementary Fig.  26  is conducted under AM1.5 G illumination, a multicolour LED solar simulator, with an illumination intensity of 100 mW cm -2 . The spectra of the LED simulators used in Fig.  5f  and Supplementary Fig.  26  are presented in Supplementary Fig.  33  and Supplementary Fig.  34 , respectively. In both setups, the device chamber was sealed and purged with nitrogen during room temperature tests (ISOS-L-1I) and MPP was monitored using a perturb and observe algorithm that updated the MPP point every 10 s. The devices were encapsulated by placing a glass slide on top and securing it with UV-adhesive (Lumtec LT-U001). ) ax1.set_yticks(tree_indices) ax1.set_ylim((len(headers)-10,len(headers))) font1 = {'family' : 'Arial', 'weight' : 'normal', 'size' : 21,} ax1.set_xlabel('Feature Importance',font1) ax1.set_ylabel('Feature names',font1) ax1.set_title("Random Forest Model",font1) plt.tick_params(labelsize=18) fig.tight_layout() plt.savefig('Random_forest_feature.tif',bbox_inches='tight', dpi=400) # The results of feature importance are shown in Supplementary Fig. 6. 
 nature materials https://doi.org/10.1038/s41563-023-01705-y Article Anion optimization for bifunctional surface passivation in perovskite solar cells Jian Xu 1,4 , Hao Chen 1,4 , Luke Grater 1,4 , Cheng Liu 2 , Yi Yang 2 , Sam Teale 1 , Aidan Maxwell 1 , Suhas Mahesh 1 , Haoyue Wan 1 , Yuxin Chang 1 , Bin Chen 1,2 , Benjamin Rehl 1 , So Min Park 1 , Mercouri G. Kanatzidis 2 & Edward H. Sargent 1,2,3 
 Received: 24 24 January 2023 Accepted: 27 September 2023 Published online: 30 October 2023 Check for updates 1 
 Article https://doi.org/10.1038/s41563-023-01705-y 
 Fig. 1 | 1 Fig. 1 | Workflow to identify candidate PH anions as passivants to improve PV performance in PSCs. a, Material screening process workflow with six screening tiers.VBM, valence band maximum; CBM, conduction band minimum. b, Schematic of the interaction between PH anions with the perovskite surface. 
 c, Formation energies (ΔE formation ) of the substitution versus adsorption mechanisms, as a function of the iodine chemical potential. The E formation of the adsorption mechanism was set as the reference (zero). 3D, three-dimensional. Article https://doi.org/10.1038/s41563-023-01705-y 
 Fig. 2 | 2 Fig. 2 | Determination of the ranking and chemical role of physical features that dominate binding energy performance of candidate PH anions. a, DFT-calculated E b of different anions with V I at the perovskite surface. Sixteen previously reported anions (left) and 24 unreported PH anions (right) with E b > 3 eV that do not create trap states on the perovskite surface are shown. b, Nineteen features as ML inputs. ESP and functional group type of the electron- 
 Fig. 3 | 3 Fig. 3 | Computational studies of bifunctional ligand candidates. a, Defect formation energies (ΔE f ) of I Pb anti-site defects when PH anions are substituted at the V I site. The values in the I -case were set to zero for comparison. Sodium thioglycolate (ST) was the most effective passivator. The numbers next to the data points correspond to the assigned number for each PH anion. b, The negative of ICOHP (-ICOHP) at the Fermi level (E F ) for X-Pb bonding (X = S/O/Cl/F) for ligands 13, 14, 21, 22 and 23 adsorbed perovskite surfaces. c, Energy profile and migration barrier for I -/Br -/Cl -/F -/ligand 14 migration on the perovskite surface. Atomic configurations (initial state (IS), transition state (TS) and final state (FS)) of ligand 14 migrations along the migration pathways are shown. d, Molecular structures of the 24 potential PH anions. These are labelled 1-24 in the same manner as in Fig. 2a. S atoms, yellow; O atoms, red; Pb atoms, grey; I atoms, purple. 
 FFFig. 4 | 4 Fig. 4 | Experimental study of device performance in PH anion-treated devices compared to relevant controls. a, Inverted perovskite solar cell architecture. b, J-V scans of the control, NaI and five PH anion-treated devices (ST (ligand 14); SC (ligand 2); PB (ligand 7); SH (ligand 13); MMP (ligand 12)). c, Comparison of PV performance among control, NaI and five PH anion-treated PSCs (aperture area, 0.049 cm 2 ) processed in the same runs (15 devices for each type). The box plot denotes minima (bottom line), maxima (top line), median (centre line), and 75th (top edge of the box) and 25th (bottom edge of the box) percentiles. REV, reverse scan; FWD, forward scan. 
 Fig. 5 | 5 Fig. 5 | Experimental characterization of ST-treated perovskite films and device stability. a, XRD patterns of control and ST-treated perovskite films. The symbols of * and # represent the PbI 2 peak and ITO peak, respectively. b, XPS spectra of O 1s of control and ST-treated films. c, XPS spectra of S 2p of control and ST-treated films. d, XPS spectra of Pb 4f of control and ST-treated films. 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 .56% (in lab) X anion (PH anions) This work Supplementary Table 2 ROC AUC score and accuracy score of the training and test sets using five different classification ML models. ROC AUC score Accuracy score training set test set training set test set Random forest model 0.83 0.82 0.84 0.84 Gradient boosting classifier model 0.84 0.85 0.84 0.84 XGboost model 0.83 0.86 0.85 0.87 Support vector classifier model 0.82 0.84 0.84 0.84 Logistic regression model 0.80 0.79 0.81 0.78 
 Portfolio wishes to improve the reproducibility of the work that we publish. This form provides structure for consistency and transparency in reporting. For further information on Nature Portfolio policies, see our Editorial Policies and the Editorial Policy Checklist. . # Plot ROC curve and AUC score import numpy as np import matplotlib.pyplot as plt Reporting Summary from sklearn import svm, datasets from sklearn.metrics import auc from sklearn.metrics import RocCurveDisplay Statistics from sklearn.model_selection import StratifiedKFold For all statistical analyses, confirm that the following items are present in the figure legend, table legend, main text, or Methods section. n_samples, n_features = X.shape n/a Confirmed from sklearn.model_selection import StratifiedKFold The exact sample size (n) for each experimental group/condition, given as a discrete number and unit of measurement tprs = [] A statement on whether measurements were taken from distinct samples or whether the same sample was measured repeatedly aucs = [] The statistical test(s) used AND whether they are one-or two-sided mean_fpr = np.linspace(0, 1, 100) Only common tests should be described solely by name; describe more complex techniques in the Methods section. A description of all covariates tested fig, ax = plt.subplots() A description of any assumptions or corrections, such as tests of normality and adjustment for multiple comparisons A full description of the statistical parameters including central tendency (e.g. means) or other basic estimates (e.g. regression coefficient) for i, (train, test) in enumerate(cv.split(X, Y)): AND variation (e.g. standard deviation) or associated estimates of uncertainty (e.g. confidence intervals) rf.fit(X.iloc[train],Y.iloc[train]) For null hypothesis testing, the test statistic (e.g. F, t, r) with confidence intervals, effect sizes, degrees of freedom and P value noted viz = RocCurveDisplay.from_estimator(rf, X.iloc[test], Y.iloc[test], Give P values as exact values whenever suitable. name='ROC fold {}'.format(i), alpha=0.3,lw=1, ax=ax) For Bayesian analysis, information on the choice of priors and Markov chain Monte Carlo settings interp_tpr = np.interp(mean_fpr, viz.fpr, viz.tpr) For hierarchical and complex designs, identification of the appropriate level for tests and full reporting of outcomes interp_tpr[0] = 0.0 Estimates of effect sizes (e.g. Cohen's d, Pearson's r), indicating how they were calculated tprs.append(interp_tpr) Our web collection on statistics for biologists contains articles on many of the points above. aucs.append(viz.roc_auc) Software and code Policy information about availability of computer code ax.plot([0, 1], [0, 1], linestyle='--', lw=2, color='r', label='Chance', alpha=.8) Data collection Supplementary Note 11 mean_tpr = np.mean(tprs, axis=0) Data analysis Supplementary Note 12 mean_tpr[-1] = 1.0 For manuscripts utilizing custom algorithms or software that are central to the research but not yet described in published literature, software must be made available to editors and mean_auc = auc(mean_fpr, mean_tpr) reviewers. We strongly encourage code deposition in a community repository (e.g. GitHub). See the Nature Portfolio guidelines for submitting code & software for further information. std_auc = np.std(aucs) ax.plot(mean_fpr, mean_tpr, color='b', label=r'Mean ROC (AUC = %0.2f $\pm$ %0.2f)' % (mean_auc, std_auc), lw=2, alpha=.8) std_tpr = np.std(tprs, axis=0) tprs_upper = np.minimum(mean_tpr + std_tpr, 1) Nature 
 Use the terms sex (biological attribute) and gender (shaped by social and cultural circumstances) carefully in order to avoid confusing both terms. Indicate if findings apply to only one sex or gender; describe whether sex and gender were considered in study design whether sex and/or gender was determined based on self-reporting or assigned and methods used. Provide in the source data disaggregated sex and gender data where this information has been collected, and consent has been obtained for sharing of individual-level data; provide overall numbers in this Reporting Summary. Please state if this information has not been collected. Report sex-and gender-based analyses where performed, justify reasons for lack of sex-and gender-based analysis. Population characteristics Describe the covariate-relevant population characteristics of the human research participants (e.g. age, genotypic information, past and current diagnosis and treatment categories). If you filled out the behavioural & social sciences study design questions and have nothing to add here, write "See above." Recruitment Describe how participants were recruited. Outline any potential self-selection bias or other biases that may be present and how these are likely to impact results.