Paper #: 82
Defect passivation in hybrid perovskite solar cells using quaternary ammonium halide anions and cations
Supplementary Figure  2 : SEM images for MAPbI 3 film after quaternary ammonium halides (QAHs) deposition. No obvious damage to the morphology of the film was observed.
The ionic defects at the surfaces and grain boundaries of organic-inorganic halide perovskite films are detrimental to both the e ciency and stability of perovskite solar cells. Here, we show that quaternary ammonium halides can e ectively passivate ionic defects in several di erent types of hybrid perovskite with their negative-and positive-charged components. The e cient defect passivation reduces the charge trap density and elongates the carrier recombination lifetime, which is supported by density-function-theory calculation. The defect passivation reduces the open-circuit-voltage deficit of the p-i-n-structured device to 0.39 V, and boosts the e ciency to a certified value of 20.59 ± 0.45%. Moreover, the defect healing also significantly enhances the stability of films in ambient conditions. Our findings provide an avenue for defect passivation to further improve both the e ciency and stability of solar cells. O rganic-inorganic halide perovskite (OIHP) semiconductors embrace a unique set of intriguing optoelectronics attributes, such as strong light absorption  1  , high charge carrier mobility  2  , and long intrinsic carrier recombination lifetime  3  , achieving impressive power conversion efficiencies (PCEs) with a relatively simple and low-cost route. The history of PCE enhancement for thin-film and polycrystalline photovoltaic cells has witnessed the importance of reducing charge-recombination loss both inside the photoactive layer and at the electrode contacts  [4] [5] [6] [7] [8]  . Passivation of defects at the film surface becomes critical when the charge recombination inside the OIHP layer is negligible  5, 9  . The insensitivity to point defects and easy crystallization of OHIP materials give rise to negligible charge recombination in perovskite polycrystalline thin films. However, the much shorter measured photoluminescence recombination lifetime of the polycrystalline films than the intrinsic carrier recombination lifetime from a singlecrystal interior indicates that there is still a high density of defects at the surface and grain boundaries of polycrystalline grains that are not benign electronically  [10] [11] [12] [13]  . These defects most likely originate from the low thermal stability, or low formation energy of OHIP materials containing organic components that easily evaporate from the surface during the thermal annealing process  [14] [15] [16] [17]  . These surface and grain boundary (GB) defects may not dramatically reduce device photocurrent output, because some of the trapped charges may still escape over a long time and be collected by the electrodes, as evidenced by the relatively large short circuit current (J SC ) of many non-optimized devices, while they would significantly impact the open circuit voltage (V OC ) of the devices due to their energy disorder and reduced carrier concentration, which pull down the quasi-Fermi level splitting  [18] [19] [20]  . In addition, these defects can cause other device instability issues, including ion migration and associated current hysteresis, and device degradation in ambient environment  17, 21, 22  . Our recent study of moisture-dependent perovskite grain stability clearly showed that the degradation of perovskite grains was initialized by the defective surface and GBs, while some single crystals with low surface defect density and no GBs could be stable in air for several years  23  . The ionic defects (for example, iodine or methylammonium vacancies) in the polycrystalline film have a small migration activation energy (<0.1 eV) under 1 sun illumination  [24] [25] [26]  . The defects could also initialize the permeation of moisture or oxygen into the perovskite films to accelerate the degradation of perovskite devices. Thus, it is highly desirable to electronically passivate the defects at surface and GB to boost the PCE, and to heal these defects to prolong the durability of OIHP solar cells. The ionic nature of OIHP materials imposes different requirements for defect passivation than covalent-bonding semiconductors such as silicon (Si), because the defects in OIHP materials are charged, either positively or negatively. The passivation of Si is mainly achieved by the elimination of the Si dangling bonds by formation of Si-O, Si-N or Si-H covalent bonds  [27] [28] [29]  , which is however not applicable to strong ionic OIHPs. So far, different passivation molecules have been reported to perform as electron donors or electron acceptors that can interact with the charged defects of OIHPs, and thereafter annihilate the relevant defectinduced charge traps  11, [30] [31] [32] [33] [34] [35]  . Lewis acids, such as phenyl-C61-butyric acid methyl ester (PCBM), as a good electron transporting material could accept an electron from the negative-charged Pb-I antisite defects PbI 3 -or under-coordinated halide ions and thus passivate the halide-induced deep traps  11, 30, 31  . Lewis base molecules, such as thiophene or pyridine, usually perform as the electron donors, which could bind to the positively charged under-coordinated Pb 2+ ions  [32] [33] [34]  . However, most of these passivation molecules could only passivate one type of defect, either positive or negative charged defects. The passivation of charge defects in OIHP should take the charge neutrality into consideration. In this study, we report that quaternary ammonium halides (QAHs) with a structure of NR + 4 X -, where R is an alkyl or aryl group and X is halide, can efficiently passivate charged defects in OIHP with quaternary ammonium and halide ions. The QAH passivation remarkably reduces the trap density and prolongs the carrier lifetime, which universally enhances the V OC of the OIHP planar heterojunction devices with different bandgaps and consequently increases the PCE by 10%-35% compared with the devices with PCBM passivation. This strategy can also enhance the stability of OIHP devices, with almost no efficiency loss after 800 h of storage in ambient conditions. These results highlight the importance of allround passivation of charged ionic defects for improvement of the efficiency and durability of OIHP devices. 
 Photovoltaic device architecture and performance The planar heterojunction perovskite solar cells in this study were structured as poly[bis(4-phenyl)(2,4,6-trimethylphenyl)amine] (PTAA)/CH 3 NH 3 PbI 3 /functional layer/fullerene (C 60 )/2,9-dimethyl-4,7-diphenyl-1,10-phenanthroline (BCP)/copper (Cu), as shown in Fig.  1a . Here the active layers of CH 3 NH 3 PbI 3 were formed by the low-temperature two-step interdiffusion of lead iodide (PbI 2 ) and a methyl ammonium iodide (MAI) stacking layer, and then followed by a solvent annealing process  [36] [37] [38]  . In our previous studies, the fullerene derivative PCBM is used as the perovskite passivation material, which is used for the control device here. With an initial objective to enhance their moisture stability, we replaced PCBM by amphiphilic molecules with different functional groups, including L-α-phosphatidylcholine, Tween 20 and polyethyleneblock-poly(ethylene glycol) (PE-PEG) whose chemical structures are shown in Fig.  1c, d . Our parallel studies showed that converting the surface of the electron transport layer to hydrophobic could enhance the water resistance of the perovskite films and device stability in moisture  39  . The application of amphiphilic materials was designed to attach them to the perovskite layer with the hydrophilic side, and expose the hydrophobic side to air  40, 41  . Figure  2a     J-V ) characteristics of two-step-processed MAPbI 3 devices with di erent passivation layers: PCBM (blue), Tween 20 (orange), L-α-phosphatidylcholine (red) and polyethylene-block-poly(ethylene glycol) (PE-PEG) (green). b, J-V curves for the two-step-processed MAPbI 3 devices passivated by PCBM (blue), L-α-phosphatidylcholine (green), choline chloride (red) and choline iodide (violet). c, The statistics of V OC distribution for devices with PCBM (blue), L-α-phosphatidylcholine (green), choline iodide (violet) and choline chloride (red). (Statistics from 16 samples on the same type of substrates for each passivation molecule.) The solid lines represent the Gauss distribution fitting for the statistic of V OC . d, J-V characteristics of one-step-processed FA 0.83 MA 0.17 Pb(I 0.83 Br 0.17 ) 3 devices with choline chloride layers (red). e, J-V curves of the champion device prepared by choline chloride passivation measured in both reverse (red) and forward (blue) scanning directions. with deposition of different passivation layers. The control device with the PCBM layer showed typical performance with a short circuit current density (J SC ) of 22.5 ± 0.39 mA cm -2 , a V OC of 1.04 ± 0.02 V, a fill factor (FF) of 73.0 ± 2.05%, and a PCE of 17.1 ± 1.1%. Compared with the device with PCBM layers, the performances of the MAPbI 3 devices with Tween and PE-PEG buffer layers were even worse with maximum PCE between 13.6% and 15.5%, even after we optimized the concentration of Tween and PE-PEG. This indicates that Tween and PE-PEG cannot passivate the surface defects on MAPbI 3 . In striking contrast, the devices with the L-α-phosphatidylcholine layer showed a significantly improved performance with a J SC of 22.7 mA cm -2 , a V OC of 1.08 V, a FF of 80.0%, and a PCE of 19.6% for the best device. The average PCE of the devices with L-α-phosphatidylcholine reached 18.7 ± 0.9%. The performance enhancement and hysteresis-free behaviour (Fig.  2a  and Supplementary Fig.  1 ) were tentatively attributed to the passivation effect of L-α-phosphatidylcholine molecules. The distinct performance led us to think about what is unique about the L-α-phosphatidylcholine molecule in passivating MAPbI 3 . In comparison with Tween and PE-PEG, L-α-phosphatidylcholine has the same long alkyl chain, while the difference is that L-α-phosphatidylcholine has a choline phosphate zwitterion structure that is a type of neutral molecule with both positive and negative electrical charges. Thus, we speculate that its zwitterion structure with the choline group passivates MAPbI 3 . To verify this, we used two other choline zwitterion molecules, also known as quaternary ammonium halides, including choline iodide and choline chloride, which have no long alkyl chain, as the interfacial layer. As shown in Fig.  2b , the V OC of the perovskite devices was significantly increased by choline iodide and choline chloride as passivation layers without sacrificing the J SC and FF of the devices, which confirmed our speculation. The devices with choline iodide and choline chloride showed higher V OC of 1.14 and 1.15 V. Consequently, the highest PCEs of the CH 3 NH 3 PbI 3 Figure  2c  shows the V OC distribution of the devices with different passivation layers. The average V OC values are 1.04, 1.09, 1.13 and 1.13 V for the devices with PCBM, L-α-phosphatidylcholine, choline iodide and choline chloride, respectively. The larger average V OC of the devices passivated by QAHs than by L-α-phosphatidylcholine indicates that there is an additional passivation effect from the halide ions, because both of them have the quaternary ammonium component. Supplementary Fig.  2  shows scanning electron micrographs for MAPbI 3 film after QAH deposition, which reveals no obvious damage to the morphology of the film. There are both positively charged cationic and negatively charged anionic defects in OIHPs, such as I -and MA + vacancies, respectively, while quaternary ammonium ions are expected to passivate only MA + vacancies by occupying cuboctahedral sites to compensate the MA + loss on the film surfaces, as illustrated in Fig.  1b . Loss of halide ions by the evaporation of MAI during the thermal annealing process needs to be compensated by additional halide ions. Therefore, a complete defect passivation is critical in achieving the high-efficiency device reported here. The notable better passivation effect of choline chloride than choline iodide can be explained by the stronger Pb-Cl bonding than Pb-I bonding, and a small amount of Cl addition has been broadly reported  13, 42  to enhance the charge-recombination lifetime in MAPbI 3 . On the basis of the mechanism of passivation presented here, any zwitterion molecular structure should have a good passivation effect, because they have both negative and positive electric charges. A zwitterion molecule may passivate both cationic and anion defects if the spacing of these defects happens to be the same as the size of the zwitterion molecule. However, the defects at the surface of perovskite films may have very complicated distributions and compositions. The positive and negative charge defects may distribute away from each other, and their molar ratio may not be 1:1, because the perovskite film surface does not necessarily reach thermal dynamic stable states right after annealing processing, and the surface defects may pair up with bulk defects. In this context, the QAH molecule with separated positive and negative ions has the advantage of selfadaptive selection of defects with opposite charges for passivation, which is not limited by the complicated surface defect composition or distribution. To test the passivation effect of QAH for perovskite films fabricated by different methods and with different compositions, various perovskite absorbers were fabricated by various approaches including a one-step anti-solvent method  43  and a two-step interdiffusion method  [36] [37] [38]  , and with different compositions of OIHPs whose bandgaps vary from 1.51 to 1.72 eV. The device fabrication method, composition and performance are summarized in Table  1 . For the FA 0.83 MA 0.17 Pb(I 0.83 Br 0.17 ) 3 perovskite films made by one-step anti-solvent methods, choline chloride passivation can also greatly improve the photovoltaic performance, as shown in Fig.  2d . The best PCE of 21.0 % was achieved by choline-chloridepassivated FA 0.85 MA 0.15 Pb(I 0.85 Br 0.15 ) 3 with a J SC of 23.7 mA cm -2 , V OC of 1.13-1.14 V, and FF of 78.0 % under forward and reverse scanning with negligible hysteresis, as shown in Fig.  2e . The photovoltaic parameters of the FA 0.85 MA 0.15 Pb(I 0.85 Br 0.15 ) 3 devices (20 cells) with different passivation treatments are summarized in Supplementary Fig.  4 , indicating significant V OC enhancement and excellent reproducibility for the devices with choline chloride passivation. The average PCE of the devices with choline chloride is 20.1 ± 0.42%. One of the unencapsulated devices was sent to an accredited independent photovoltaic test laboratory (Newport Corporation PV Lab, Montana, USA) for certification. The device with a photomask area of 7.16 mm 2 displayed a certified PCE of 20.59 ± 0.45% and an absence of photocurrent hysteresis (Supplementary Fig.  3 ), which represents a record PCE for p-i-n structured OIHP solar cells. The reported certified PCEs of the planar heterojunction OIHP solar cells reached 19.9% and 20.1% based on SnO 2 and chlorine-capped TiO 2 electron transport layers, respectively  44, 45  . The passivation effect on FA 0.83 MA 0.17 Pb(I 0.6 Br 0.4 ) 3 with a bandgap of 1.72 eV demonstrated significant improvement with an increased PCE of 17.2% after QAH passivation (Supplementary Fig.  5 ), which is among the highest PCEs for perovskite solar cells with a similar bandgap. The average PCE of the FA 0.83 MA 0.17 Pb(I 0.6 Br 0.4 ) 3 devices is 16.1 ± 1.1%. Two-step-processed FA x MA 1-x Pb(Br 1-x I x ) 3 perovskites with an optical bandgap of 1.51 eV were also used to test the passivation effect of the QAH. It should be noted that it is difficult to exactly determine the composition of the perovskite films processed by the two-step method, so we write the composition of FA x MA 1-x Pb(Br 1-x I x ) 3 here. The V OC increased from 1.04 to 1.12 V and the highest PCE was boosted from 18.7% to 20.2% after replacing PCBM with choline chloride, as shown in Supplementary Fig.  6 . A smallest V OC deficit of 0.39 V was achieved. The average PCEs of the FA x MA 1-x Pb(Br 1-x I x ) 3 devices with PCBM and choline chloride layers are 17.5 ± 1.2% and 19.3 ± 0.9%, respectively. Furthermore, we incorporated choline chloride into the FA 0.83 MA 0.17 Pb(I 0.83 Br 0.17 ) 3 perovskite films by blending the choline chloride in the perovskite precursor solution before depositing it on the PTAA layers. The V OC of such devices is comparable to those with only surface treatment by choline chloride (Supplementary Fig.  7 ). It should be noted that we do not expect the choline chloride blended in precursor solution would be incorporated into the perovskite lattice due to its too large molecular size, and thus the choline chloride is expected to stay at the film surface and/or grain boundaries during perovskite film formation. This result basically confirms that the surface charge traps cause the majority of the V OC losses in perovskite solar cells. Nevertheless, the capability of directly blending the choline chloride in the precursor solution for film fabrication does reduce an additional step of coating with choline chloride.  
 Mechanistic study of passivation e ect of QAHs Time-resolved photoluminescence decay measurements (Fig.  1e ) of MAPbI 3 perovskite films with different passivation layers were performed to find the origin of the improved efficiency. The timeresolved photoluminescence decay of perovskite films with different passivation layers showed a bi-exponential decay with a fast and a slow component. Previous studies of charge recombination in perovskite films suggest that the fast decay process is caused by bimolecular recombination of photo-generated free carriers, and the slow decay process is attributed mainly to trap-assisted recombination  5, 20  . Here the choline chloride passivation mainly impacted the slow decay process, agreeing with the proposed mechanism that choline chloride passivates charge traps at the film surface. For the trapassisted recombination, we deduced an increased recombination lifetime from 82.3 ns for the pristine film to 903.4 ns after choline chloride treatment. The steady-state photoluminescence spectrum (Supplementary Fig.  8 ) shows that the choline-chloride-treated OIHP film had a sixfold stronger photoluminescence intensity than the control film. To find out how passivation affects the chargerecombination process in the operating devices, transient photovoltage measurement of the MAPbI 3 perovskite device was conducted. The devices were soaked under AM 1.5 simulated illumination, and laser pulses (337 nm, 4 ns) were applied to disturb the opencircuited devices to trigger a small transient photovoltaic signal. As seen in Fig.  1f , the charge-recombination lifetime of the device with choline chloride passivation was increased to 0.56 µs in comparison with the 0.23 µs of the device with PCBM passivation. The transient photovoltage result also shows that the device with choline chloride passivation had a larger average photovoltage of 1.13 V than the devices with a PCBM layer (1.04 V), which is in accordance with the J -V measurement. For polycrystalline MAPbI 3 perovskite films, the reported trap densities are generally in the order of 10 17 -10 19 m -3 , which are much larger than that of the single crystals (10 10 m -3 ), giving much room for improvement  46  . To further analyse the passivation effect of the QAH, the trap density of states (tDOS) was measured for the devices fabricated by two-step-processed MAPbI 3 perovskite with choline chloride or PCBM passivation. We extracted the trap densities from the thermal admittance spectroscopy analysis, which is a well-established and effective technique to characterize both shallow and deep defects of thin-film and organic solar cells  11, 47  . Figure  3a  shows that the device with choline chloride layers had overall the lowest tDOS over the whole trap depth region. The device with choline chloride layers had low tDOS in the deeper trap region (0.40-0.52 eV), which was assigned to defects at the film surface  11  . In addition, the density of shallower trap states (0.35-0.40 eV), which was assigned to traps at GBs, in the choline-chloride-passivated devices was about three times smaller than in the PCBM-passivated devices. This indicates that choline chloride may also diffuse into grain boundaries to passivate them. The better passivation effect of choline chloride than PCBM verifies that both cationic and anionic defects in OIHPs need to be considered in passivation techniques. As proof of the concept, two typical surface defect sites that have been reported to generate deep charge traps in OIHPs, an anionic Pb-I antisite defect on a PbI 2 -terminated surface and a cationic Pb cluster on a MAI-terminated surface, were investigated to demonstrate the trap passivation effect of the selected molecules  14, 30  . We used a Pb-I antisite defect on a PbI 2 -terminated surface, and uncoordinated Pb clusters on MAI-terminated surface slabs that have a 2 × 2 periodicity in the xy plane, and the representative structure model can be found in Fig.  3b-e  in Supplementary Fig.  12 , the bond distances of d Pb1 -I1 and d Pb1 -I2 are 4.76 Å and 3.14 Å in the unpassivated system, and 3.54 Å and 3.39 Å in the passivated system. In the resulting binding structure of the Pb cluster after the passivation, the Pb cluster on the top of the MAI surface is bonded with Cl -and two I -of the top layer of MAI. The enhanced interaction between Pb and the surface slab resulted in an increase of the overlap between the wavefunction of the Pb cluster and the surface slab. This enhanced interaction between the Pb ion cluster and the MAI-terminated surface causes new hybridized states that bridge the trap states with conduction band edge states of the surface slabs, which prevents the trapping of charges. This enhanced interaction between Pb and the surface slab could also induce a slight shift of the band edge. For the PbI 3 antisite defects, the simulation shows that the gap states are almost eliminated after passivation, which has a better passivation effect as compared with PCBM  30  . Besides, the passivated surface also has a slightly larger bandgap than the unpassivated one. The shifts of trap states and band edges are primary due to the charge transfer between the passivation molecule and perovskite surface. The Bader charge analysis shows that the choline molecule can transfer about 0.8 electrons to the surface in the case of PbI 3 -antisite defects. When adding choline chloride in the system, the defects undergo 
 NATURE ENERGY 
 ARTICLES a migration process (Supplementary Fig.  13 ): the antisite I -moves to the top position of its neighbouring Pb  2+  and bonds with that Pb 2+ , leaving a Pb 2+ vacancy on the surface, and this Pb 2+ vacancy defect is reported to be benign  14  . Since choline chloride contains both positive and negative charges, we expect that it also interacts strongly with other charged defects. The density functional theory calculations indicate that QAHs could passivate trap states induced by both the cationic and anionic defect sites, a special feature for the passivation agents selected. It should be noted that the types of defect present at the perovskite films surface might be sensitive to the film formation process. It is not technically feasible yet to find out what types of defect are present in the perovskite films presented here. Therefore, it is not yet feasible to conclude that QAHs could passivate all types of defect at the film surface. Understanding the nature of surface defects will still be needed to ultimately understand the functions of the QAHs reported here. 
 Stability of the perovskite solar cells with QAHs The stability of OIHP devices in ambient conditions is challenged by their sensitivity to moisture and oxygen due to the hygroscopic nature of the OIHP films. Recent studies revealed that the degradation of perovskite films was generally initialized at the defect sites at the film surface and grain boundaries where the molecules have highest activity and diffusivity and are more susceptible to attack by moisture and oxygen  23, 41  . It should be noted that the defects that cause charge trapping and initialize material degradation might be different. Although surface defects such as MA + vacancies formed by the evaporation of MAI during annealing do not cause deep traps in the perovskite material or impact the device efficiency, they may initialize the film degradation. Nevertheless, QAH ions are expected to have strong interaction with such ionic defects to neutralize the charges. We thus speculate that the interaction of the perovskite films with the choline chloride layer should also enhance the stability of the perovskite films in ambient environment, because covering the defective sites on the film surface with QAH ions should inhibit the permeation of moisture and oxygen through the defects. To verify this, the stability of FA 0.83 MA 0.17 Pb(I 0.83 Br 0.17 ) 3 devices with choline chloride and L-α-phosphatidylcholine functional layers was monitored by putting the unencapsulated devices in an ambient atmosphere at room temperature and relative humidity of 50-85%, and the device performances are summarized in Fig.  4 . The devices with choline chloride layers retained almost 100% of the initial PCEs after storage in ambient conditions for over one month. Interestingly, the V OC of the devices increased during the first 5 days of storage in both types of device with choline chloride passivation. The L-α-phosphatidylcholine-modified devices showed inferior performance, 30% loss of the initial PCE after 800 h storage in ambient conditions, despite the fact that the long hydrophobic alkane tails could hinder the permeation of moisture. The difference in stability of the devices with two passivation layers highlighted the importance of healing both types of defect. Figure  4e  shows the maximum power point tracking of the devices with choline chloride. The results show that the PCE decreased from 21.1% to 18.1%, and maintained 86% of the initial PCE under 1 sun continuous illumination for 26 h. The humidity stability test for the bare OIHP films (Fig.  4f-k ) shows that the films with QAHs have a much slower degradation rate than the control films without QAHs when they were exposed to humidity of 90 ± 5% for the same time intervals of 2.5 h, and the corresponding X-ray diffraction results are shown in Supplementary Fig.  14 . The much slower reduction of the perovskite (110) plane peak and the slower appearance of the PbI 2 peak in the perovskite films with L-α-phosphatidylcholine and choline chloride treatment demonstrate the better moisture resistance capability enabled by the surface modification. This result conclusively confirmed that the healing of the defect sites by choline chloride could effectively improve the moisture stability of OIHP films. 
 Conclusion In summary, we have demonstrated that the passivation of ionic defects in OIHPs by QAHs is a general passivation approach to remarkably improve the efficiency and stability of OIHP solar cells. This strategy could lead to further increasing the PCE of perovskite solar cells by passivating both types of charged ionic defect in OIHPs. There is still room to further improve the passivation effect, as indicated by the photoluminescence lifetime of the perovskite films, which still have not reached that of the single crystals. Further understanding of the nature of the surface defects in polycrystalline OIHPs, including the defect type, defect concentration and defect distribution, will be very important to guide the design of nextgeneration passivation molecules to fully passivate all of the defects. We anticipate that the precision defect healing will be an important direction to improve the efficiency of perovskite solar cells to the theoretical limit, as well as to stabilize perovskite-based materials and devices. 
 Methods Device fabrication. The MAPbI 3 films made by the two-step method were fabricated by the thermal annealing-induced interdiffusion method according to our previous publication  [36] [37] [38]  . The hole transport layer poly(bis(4-phenyl)(2,4,6-trimethylphenyl)amine) (PTAA) with a concentration of 2 mg ml -1 dissolved in toluene was spin-coated at the speed of 6,000 r.p.m. for 35 s and then annealed at 100 • C for 10 min. PbI 2 beads (99.999% trace metals basis) were purchased from Sigma-Aldrich. After dissolving in N ,N -dimethylformamide (DMF) at a temperature of 100 • C, around 50 µl of hot (∼90 • C) 630 mg ml -1 PbI 2 DMF precursor solution was quickly dropped onto the substrate and spin-coated at the speed of 6,000 r.p.m. The as-fabricated PbI 2 films were dried and annealed at 90 • C for 10 min. After the PbI 2 films cooled to 70 • C, 60 µl of 63 mg ml -1 methylammonium iodide (MAI) 2-propanol (IPA) precursor solution at the temperature of 70 • C was spun on the PbI 2 films. Subsequently, the sample was annealed at 70 • C for 20 min and 100 • C for 60 min. During the thermal annealing process, around 10 µl of DMF was added to the edge of the Petri dish when the temperature reached 100 • C. Two-step-processed FA x MA 1-x Pb(Br 1-x I x ) 3 perovskites were made by a similar procedure to the MAPbI 3 films made by the two-step method. The main differences are: the concentration of PbI 2 solution used for spin-coating is 680 mg ml -1 ; the mixed halide precursor solution contains 90 wt% of FAI and 10 wt% MABr with a concentration range from 70 mg FAI/7 mg MABr to 75 mg FAI/7 mg MABr per millilitre. One-step-processed narrow-bandgap perovskite FA 0.83 MA 0.17 Pb(Br 0.17 I 0.83 ) 3 and wide-bandgap perovskite FA 0.83 MA 0.17 Pb(Br 0.4 I 0.6 ) 3 were fabricated by the solvent-and interface-engineering method as reported previously  43  . The process for making the hole transport layer PTAA film is exactly the same as the fabrication method mentioned in the two-step method. The perovskite precursor solution composed of mixed cations (lead (Pb), formamidinium (FA) and methylammonium (MA)) and halides (I, Br) was dissolved in mixed solvent (DMF/DMSO = 4:1). To improve the wetting property of the perovskite precursor on the PTAA film, the PTAA-coated ITO substrate was pre-wetted by spinning 50 µl DMF at 4,000 r.p.m. for 8 s. Then 100 µl precursor solution was spun onto PTAA at 2,000 r.p.m. for 2 s and 4,000 r.p.m. for 20 s, and the sample was quickly washed with 130 µl toluene at 13 s of the second-step spin-coating. Subsequently, the sample was annealed at 65 • C for 10 min and 100 • C for 10 min. The passivation material solution was coated onto the perovskite substrate by spin-coating at 4,000 r.p.m. for 35 s, and annealed at 100 • C for 30 min. The PCBM, Tween and PE-PEG were dissolved in DCB, and the choline chloride and choline iodide were dissolved in IPA with a concentration of 1 mg ml -1 . The devices were finished by thermally evaporating C 60 (23 nm), BCP (8 nm) and copper (80 nm) in sequential order. Device characterization. Simulated AM 1.5G irradiation (100 mW cm -2 ) was produced by a xenon-lamp-based solar simulator (Oriel 67005, 150 W Solar Simulator) for current density-voltage (J-V ) measurements. The light intensity was calibrated by a silicon (Si) diode (Hamamatsu S1133) equipped with a Schott visible-colour glass filter (KG5 colour-filter). A Keithley 2400 Source-Meter was used for J -V measurement. The scanning rate was 0.1 V s -1 . The steady-state V OC and J SC were measured by zero bias current and zero bias voltage versus time, respectively. The steady-state PCE was measured by monitoring current with the largest power output bias voltage and recording the value of the photocurrent. 
 ARTICLES NATURE ENERGY X-ray diffraction measurements were performed with a Rigaku D/Max-B X-ray diffractometer with Bragg-Brentano parafocusing geometry, a diffracted beam monochromator, and a conventional cobalt target X-ray tube set to 40 kV and 30 mA. External quantum efficiency curves were characterized with a Newport QE measurement kit by focusing a monochromatic beam of light onto the devices. The scanning electron micrographs were taken with a Quanta 200 FEG environmental scanning electron microscope. For the transient photovoltage measurements, the device was serially connected to a digital oscilloscope (DOS-X 3104A) and the input impedance of the oscilloscope was set to 1 M to form the open-circuit conditions, respectively, for monitoring the charge density decay. The transient photovoltage was measured under 1 sun illumination. An attenuated UV laser pulse (SRS NL 100 Nitrogen Laser) was used as a small perturbation to the background illumination on the device. The laser-pulse-induced photovoltage variation ( V ) and the V OC is produced by the background illumination. The wavelength of the N 2 laser was 337 nm, the repeating frequency was about 10 Hz, and the pulse width was less than 3.5 ns. First-principles calculation. First-principles calculation was carried out in the framework of density functional theory as implemented in the VASP program. The generalized gradient approximation in the form of Perdew-Burke-Ernzerhof was used for the exchange-correlation function. The ion-electron interaction is treated with the projector-augmented wave method. Surface slabs were modelled as PbI 2 -terminated or MAI-terminated symmetric (001) slabs of the tetragonal structure, which has 9 layers of MAI and PbI 2 in total. About 30 Å vacuum was added on top of the slab surface to minimize the interaction between the adjacent slabs. Humidity stability test. The perovskite OIHP films were stored at room temperature in a controlled-humidity glass chamber. The relative humidity calibrated by a digital hygrometer was controlled by the speed of nitrogen gas that flowed through the water, and the nitrogen gas eventually carries the moisture into the glass chamber. The relative humidity was maintained at 90 ± 5%. Figure 1 | 1 Figure 1 | Device structure and passivation mechanism by quaternary ammonium halides. a, The device structure of perovskite planar heterojunction solar cells. b, Schematic illustration of quaternary ammonium halides (QAHs) assembled on the defect sites. The red and blue symbols represent the N atom and O atom of the choline chloride molecule, respectively. c, Chemical structures of phenyl-C61-butyric acid methyl ester (PCBM), Tween 20, polyethylene-block-poly(ethylene glycol) (PE-PEG). d, Chemical structures of L-α-phosphatidylcholine, choline iodide and choline chloride.e, Time-resolved photoluminescence (PL) decay of perovskite films with choline chloride layers (red) compared with control film without a passivation layer (blue). The fluence and the excitation density were 2.0 nJ cm -2 and 4.07 × 10 14 cm -3 , respectively. f, Charge carrier lifetime of a choline chloride-treated device (red) and a control device with PCBM layers (blue), determined from transient photovoltage measurement under open-circuit conditions. The y axis shows the V OC of the devices with di erent treatments. 
 3 Figure 2 | 32 Figure2| Passivation-layer-dependent device performance. a, Current density-voltage (J-V) characteristics of two-step-processed MAPbI 3 devices with di erent passivation layers: PCBM (blue), Tween 20 (orange), L-α-phosphatidylcholine (red) and polyethylene-block-poly(ethylene glycol) (PE-PEG) (green). b, J-V curves for the two-step-processed MAPbI 3 devices passivated by PCBM (blue), L-α-phosphatidylcholine (green), choline chloride (red) and choline iodide (violet). c, The statistics of V OC distribution for devices with PCBM (blue), L-α-phosphatidylcholine (green), choline iodide (violet) and choline chloride (red). (Statistics from 16 samples on the same type of substrates for each passivation molecule.) The solid lines represent the Gauss distribution fitting for the statistic of V OC . d, J-V characteristics of one-step-processed FA 0.83 MA 0.17 Pb(I 0.83 Br 0.17 ) 3 devices with choline chloride layers (red). e, J-V curves of the champion device prepared by choline chloride passivation measured in both reverse (red) and forward (blue) scanning directions. 
 Figure 3 | 3 Figure 3 | Passivation mechanism. a, Trap density of states obtained by thermal admittance spectroscopy for devices with PCBM (blue), and choline chloride passivation layers (red). The vertical dashed lines define trap bands with di erent trap energy depths, shallow trap states (band 1, 0.35-0.40 eV), deep trap states (band 2 and band 3, >0.4 eV). b-e, The isosurface plots of the highest occupied valence band (b) and the lowest unoccupied conduction band (c) of the choline-chloride-passivated PbI 2 surface with the Pb-I antisite defect and isosurface plots of the highest occupied valence band (d) and the lowest unoccupied conduction band (e) of the choline-chloride-passivated MAI surface with a Pb cluster defect. f, Density of states of the passivated Pb-I antisite defect surface with choline chloride (orange) and choline iodide (green); DOS of the pristine PbI 2 surface (brown) and the unpassivated surface (blue) are also plotted for comparison. The arrows show that the gap states are shifted to the band edge. g, DOS of the choline chloride-passivated (red), choline iodide-passivated (green) and unpassivated MAI-terminated surface (blue) with a Pb cluster defect. h, Zoomed DOS (from -0.5 to 0.5 eV) near the lowest conduction band of g. 
 Figure 4 | 4 Figure 4 | Stability assessment of perovskite solar cells with di erent passivation layers. a-d, Evolution of PCE (a), J SC (b), V OC (c) and FF (d) relative to the initial parameters for the device with L-α-phosphatidylcholine (blue) and choline chloride (red) over 35 days of storage in air. Each average (symbol) and standard deviation (error bar) was calculated from six solar cells. e, Maximum power point tracking for 26 h of an unencapsulated device under continuous 1 sun illumination.f-h, Photographic images of the OIHP films without a passivation layer (f), with L-α-phosphatidylcholine (g), and with choline chloride (h), respectively, before exposure to humidity. i-k, Photographs of the OIHP films without a passivation layer (i), with L-α-phosphatidylcholine (j), and with choline chloride (k), respectively, after exposure to humidity of 90 ± 5% for 2.5 h (the size of the films is 15 × 15 mm). 
 
 
 
 
 
 
 
 
 
 
 Table 1 | Summary of the best device performance for the choline chloride and PCBM passivated devices with di erent perovskite composition. 1 Perovskite composition Bandgap (eV) Passivation layer J SC (mA cm -2 ) V OC (V) FF PCE MAPbI 3 1.55 PCBM Choline chloride 22.5 22.9 1.04 1.15 73% 76% 17.1% 20.0% FA 0.85 MA 0.15 Pb(I 0.85 Br 0.15 ) 3 1.55 PCBM Choline chloride 23.7 23.7 1.03 1.14 79% 78% 19.2% 21.0% FA 0.83 MA 0.17 Pb(I 0.6 Br 0.4 ) 3 1.72 PCBM Choline chloride 17.1 19.4 1.12 1.15 66% 77% 12.6% 17.2% devices with choline iodide and choline chloride passivation lay- ers were increased to 20.1% and 20.0%, respectively. The average PCE of the devices with choline iodide and choline chloride pas- sivation layers are 19.3 ± 0.8% and 19.4 ± 0.6%, respectively. 
			 NATURE ENERGY | DOI: 10.1038/nenergy.2017.102 | www.nature.com/natureenergy 
			 © 2017 Macmillan Publishers Limited, part of Springer Nature. All rights reserved. NATURE ENERGY | DOI: 10.1038/nenergy.2017.102 | www.nature.com/natureenergy 
			 © 2017 Macmillan Publishers Limited, part of Springer Nature. All rights reserved. NATURE ENERGY 2, 17102 (2017) | DOI: 10.1038/nenergy.2017.102 | www.nature.com/natureenergy 
			 © 2017 Macmillan Publishers Limited, part of Springer Nature. All rights reserved. NATURE ENERGY 2, 17102 (2017) | DOI: 10.1038/nenergy.2017.102 | www.nature.com/natureenergy 
			 © 2017 Macmillan Publishers Limited, part of Springer Nature. All rights reserved. 
			 © 2017 Macmillan Publishers Limited, part of Springer Nature. All rights reserved. NATURE ENERGY 2, 17102 (2017) | DOI: 10.1038/nenergy.2017.102 | www.nature.com/natureenergy 
			 NATURE ENERGY 2, 17102 (2017) | DOI: 10.1038/nenergy.2017.102 | www.nature.com/natureenergy © 2017 Macmillan Publishers Limited, part of Springer Nature. All rights reserved.